{"ast":null,"code":"import _objectSpread from\"/Users/pgmp/Desktop/todo_drf/todo_drf/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"/Users/pgmp/Desktop/todo_drf/todo_drf/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/pgmp/Desktop/todo_drf/todo_drf/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/pgmp/Desktop/todo_drf/todo_drf/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{createContext,useState,useEffect}from\"react\";// Router\nimport{useNavigate}from\"react-router\";import{jsx as _jsx}from\"react/jsx-runtime\";var AuthContext=/*#__PURE__*/createContext();export default AuthContext;export var AuthProvider=function AuthProvider(_ref){var children=_ref.children;var _useState=useState(function(){return localStorage.getItem(\"authTokens\")?JSON.parse(localStorage.getItem(\"authTokens\")):null;}),_useState2=_slicedToArray(_useState,2),tokens=_useState2[0],setTokens=_useState2[1];var _useState3=useState(function(){return localStorage.getItem(\"authTokens\")?JSON.parse(localStorage.getItem(\"authTokens\")).user:null;}),_useState4=_slicedToArray(_useState3,2),user=_useState4[0],setUser=_useState4[1];var _useState5=useState(true),_useState6=_slicedToArray(_useState5,2),loading=_useState6[0],setLoading=_useState6[1];var navigate=useNavigate();var loginUser=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var response,data,_tokens;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();_context.next=3;return fetch(\"http://127.0.0.1:8000/api/auth/login/\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({username:e.target.username.value,password:e.target.password.value})});case 3:response=_context.sent;_context.next=6;return response.json();case 6:data=_context.sent;// Status 200 === \"OK\"\nif(response.status===200){_tokens={access:data.access_token,refresh:data.refresh_token,user:data.user};setTokens(_tokens);setUser(data.user);localStorage.setItem(\"authTokens\",JSON.stringify(_tokens));navigate(\"/\");}else{alert(\"Login error!\");}case 8:case\"end\":return _context.stop();}}},_callee);}));return function loginUser(_x){return _ref2.apply(this,arguments);};}();var logoutUser=function logoutUser(){setTokens(null);setUser(null);localStorage.removeItem(\"authTokens\");};var registerUser=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e){var username,password,confirm,response,data,message,_tokens2;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:e.preventDefault();username=e.currentTarget.username.value;password=e.currentTarget.password.value;confirm=e.currentTarget.confirm.value;if(!(password!==confirm)){_context2.next=8;break;}alert(\"Passwords do not match!\");_context2.next=20;break;case 8:if(!(password<8)){_context2.next=12;break;}alert(\"This password is too short. It must contain at least 8 characters.\");_context2.next=20;break;case 12:console.log(\"Registering new user!\");_context2.next=15;return fetch(\"http://127.0.0.1:8000/api/auth/register/\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({username:username,password1:password,password2:confirm})});case 15:response=_context2.sent;_context2.next=18;return response.json();case 18:data=_context2.sent;// If a registration error occurs\nif(!data.user){if(data.username)alert(\"\".concat(data.username[0]));else if(data.password1){message=data.password1.join(\" \");alert(\"\".concat(message));}}// Otherwise, login the newly registered user\nelse{_tokens2={access:data.access_token,refresh:data.refresh_token,user:data.user};setTokens(_tokens2);setUser(data.user);localStorage.setItem(\"authTokens\",JSON.stringify(_tokens2));navigate(\"/\");}case 20:e.target.password.value=\"\";e.target.confirm.value=\"\";case 22:case\"end\":return _context2.stop();}}},_callee2);}));return function registerUser(_x2){return _ref3.apply(this,arguments);};}();var updateToken=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var response,data;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(user){_context3.next=2;break;}return _context3.abrupt(\"return\",setLoading(false));case 2:console.log(\"Updating token!\");_context3.next=5;return fetch(\"http://127.0.0.1:8000/api/auth/token/refresh/\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({refresh:tokens===null||tokens===void 0?void 0:tokens.refresh})});case 5:response=_context3.sent;_context3.next=8;return response.json();case 8:data=_context3.sent;if(response.status===200){console.log(\"Token refreshed!\");setTokens(_objectSpread(_objectSpread({},tokens),{},{access:data.access}));localStorage.setItem(\"authTokens\",JSON.stringify(_objectSpread(_objectSpread({},tokens),{},{access:data.access})));}else logoutUser();if(loading){console.log(\"Set loading to false\");setLoading(false);}case 11:case\"end\":return _context3.stop();}}},_callee3);}));return function updateToken(){return _ref4.apply(this,arguments);};}();useEffect(function(){if(loading){updateToken();}var minutes=1000*60*4;console.log(\"Four minutes\");var interval=setInterval(function(){if(tokens){updateToken();}},minutes);return function(){console.log(\"Clearing interval\");clearInterval(interval);};},[tokens,loading]);var contextData={user:user,tokens:tokens,loginUser:loginUser,logoutUser:logoutUser,registerUser:registerUser};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:contextData,children:!loading&&children});};","map":{"version":3,"sources":["/Users/pgmp/Desktop/todo_drf/todo_drf/frontend/src/context/AuthContext.js"],"names":["createContext","useState","useEffect","useNavigate","AuthContext","AuthProvider","children","localStorage","getItem","JSON","parse","tokens","setTokens","user","setUser","loading","setLoading","navigate","loginUser","e","preventDefault","fetch","method","headers","body","stringify","username","target","value","password","response","json","data","status","access","access_token","refresh","refresh_token","setItem","alert","logoutUser","removeItem","registerUser","currentTarget","confirm","console","log","password1","password2","message","join","updateToken","minutes","interval","setInterval","clearInterval","contextData"],"mappings":"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","sourcesContent":["import { createContext, useState, useEffect } from \"react\";\n// Router\nimport { useNavigate } from \"react-router\";\n\nconst AuthContext = createContext();\nexport default AuthContext;\n\nexport const AuthProvider = ({ children }) => {\n  let [tokens, setTokens] = useState(() =>\n    localStorage.getItem(\"authTokens\")\n      ? JSON.parse(localStorage.getItem(\"authTokens\"))\n      : null\n  );\n  let [user, setUser] = useState(() =>\n    localStorage.getItem(\"authTokens\")\n      ? JSON.parse(localStorage.getItem(\"authTokens\")).user\n      : null\n  );\n\n  let [loading, setLoading] = useState(true);\n\n  const navigate = useNavigate();\n\n  let loginUser = async (e) => {\n    e.preventDefault();\n    let response = await fetch(\"http://127.0.0.1:8000/api/auth/login/\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify({\n        username: e.target.username.value,\n        password: e.target.password.value,\n      }),\n    });\n    let data = await response.json();\n\n    // Status 200 === \"OK\"\n    if (response.status === 200) {\n      let tokens = {\n        access: data.access_token,\n        refresh: data.refresh_token,\n        user: data.user,\n      };\n      setTokens(tokens);\n      setUser(data.user);\n      localStorage.setItem(\"authTokens\", JSON.stringify(tokens));\n      navigate(\"/\");\n    } else {\n      alert(\"Login error!\");\n    }\n  };\n\n  let logoutUser = () => {\n    setTokens(null);\n    setUser(null);\n    localStorage.removeItem(\"authTokens\");\n  };\n\n  let registerUser = async (e) => {\n    e.preventDefault();\n    let username = e.currentTarget.username.value;\n    let password = e.currentTarget.password.value;\n    let confirm = e.currentTarget.confirm.value;\n\n    if (password !== confirm) {\n      alert(\"Passwords do not match!\");\n    } else if (password < 8) {\n      alert(\n        \"This password is too short. It must contain at least 8 characters.\"\n      );\n    } else {\n      console.log(\"Registering new user!\");\n      let response = await fetch(\"http://127.0.0.1:8000/api/auth/register/\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          username: username,\n          password1: password,\n          password2: confirm,\n        }),\n      });\n\n      let data = await response.json();\n      // If a registration error occurs\n      if (!data.user) {\n        if (data.username) alert(`${data.username[0]}`);\n        else if (data.password1) {\n          let message = data.password1.join(\" \");\n          alert(`${message}`);\n        }\n      }\n      // Otherwise, login the newly registered user\n      else {\n        let tokens = {\n          access: data.access_token,\n          refresh: data.refresh_token,\n          user: data.user,\n        };\n        setTokens(tokens);\n        setUser(data.user);\n        localStorage.setItem(\"authTokens\", JSON.stringify(tokens));\n        navigate(\"/\");\n      }\n    }\n    e.target.password.value = \"\";\n    e.target.confirm.value = \"\";\n  };\n\n  let updateToken = async () => {\n    if (!user) return setLoading(false);\n    console.log(\"Updating token!\");\n    let response = await fetch(\n      \"http://127.0.0.1:8000/api/auth/token/refresh/\",\n      {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({ refresh: tokens?.refresh }),\n      }\n    );\n    let data = await response.json();\n    if (response.status === 200) {\n      console.log(\"Token refreshed!\");\n      setTokens({ ...tokens, access: data.access });\n      localStorage.setItem(\n        \"authTokens\",\n        JSON.stringify({ ...tokens, access: data.access })\n      );\n    } else logoutUser();\n\n    if (loading) {\n      console.log(\"Set loading to false\");\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    if (loading) {\n      updateToken();\n    }\n    let minutes = 1000 * 60 * 4;\n    console.log(\"Four minutes\");\n    let interval = setInterval(() => {\n      if (tokens) {\n        updateToken();\n      }\n    }, minutes);\n    return () => {\n      console.log(\"Clearing interval\");\n      clearInterval(interval);\n    };\n  }, [tokens, loading]);\n\n  let contextData = {\n    user: user,\n    tokens: tokens,\n    loginUser: loginUser,\n    logoutUser: logoutUser,\n    registerUser: registerUser,\n  };\n\n  return (\n    <AuthContext.Provider value={contextData}>\n      {!loading && children}\n    </AuthContext.Provider>\n  );\n};\n"]},"metadata":{},"sourceType":"module"}