(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{16:function(e,t,n){},19:function(e,t,n){},20:function(e,t,n){},21:function(e,t,n){"use strict";n.r(t);var r=n(1),s=n.n(r),a=n(11),c=n.n(a),o=(n(16),n(5)),i=n(3),l=n.n(i),u=n(7),d=n(4),j=n(2),p=n(0),b=Object(r.createContext)(),h=b,m=function(e){var t=e.children,n=Object(r.useState)((function(){return localStorage.getItem("authTokens")?JSON.parse(localStorage.getItem("authTokens")):null})),s=Object(d.a)(n,2),a=s[0],c=s[1],i=Object(r.useState)((function(){return localStorage.getItem("authTokens")?JSON.parse(localStorage.getItem("authTokens")).user:null})),h=Object(d.a)(i,2),m=h[0],f=h[1],O=Object(r.useState)(!0),x=Object(d.a)(O,2),v=x[0],g=x[1],k=Object(j.g)(),y=function(){var e=Object(u.a)(l.a.mark((function e(t){var n,r,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=3,fetch("http://127.0.0.1:8000/api/auth/login/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:t.target.username.value,password:t.target.password.value})});case 3:return n=e.sent,e.next=6,n.json();case 6:r=e.sent,200===n.status?(s={access:r.access_token,refresh:r.refresh_token,user:r.user},c(s),f(r.user),localStorage.setItem("authTokens",JSON.stringify(s)),k("/")):alert("Login error!");case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),N=function(){c(null),f(null),localStorage.removeItem("authTokens")},w=function(){var e=Object(u.a)(l.a.mark((function e(t){var n,r,s,a,o,i,u;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),n=t.currentTarget.username.value,r=t.currentTarget.password.value,s=t.currentTarget.confirm.value,r===s){e.next=8;break}alert("Passwords do not match!"),e.next=20;break;case 8:if(!(r<8)){e.next=12;break}alert("This password is too short. It must contain at least 8 characters."),e.next=20;break;case 12:return console.log("Registering new user!"),e.next=15,fetch("http://127.0.0.1:8000/api/auth/register/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:n,password1:r,password2:s})});case 15:return a=e.sent,e.next=18,a.json();case 18:(o=e.sent).user?(u={access:o.access_token,refresh:o.refresh_token,user:o.user},c(u),f(o.user),localStorage.setItem("authTokens",JSON.stringify(u)),k("/")):o.username?alert("".concat(o.username[0])):o.password1&&(i=o.password1.join(" "),alert("".concat(i)));case 20:t.target.password.value="",t.target.confirm.value="";case 22:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),S=function(){var e=Object(u.a)(l.a.mark((function e(){var t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(m){e.next=2;break}return e.abrupt("return",g(!1));case 2:return console.log("Updating token!"),e.next=5,fetch("http://127.0.0.1:8000/api/auth/token/refresh/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh:null===a||void 0===a?void 0:a.refresh})});case 5:return t=e.sent,e.next=8,t.json();case 8:n=e.sent,200===t.status?(console.log("Token refreshed!"),c(Object(o.a)(Object(o.a)({},a),{},{access:n.access})),localStorage.setItem("authTokens",JSON.stringify(Object(o.a)(Object(o.a)({},a),{},{access:n.access})))):N(),v&&(console.log("Set loading to false"),g(!1));case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(r.useEffect)((function(){v&&S();console.log("Four minutes");var e=setInterval((function(){a&&S()}),24e4);return function(){console.log("Clearing interval"),clearInterval(e)}}),[a,v]);var T={user:m,tokens:a,loginUser:y,logoutUser:N,registerUser:w};return Object(p.jsx)(b.Provider,{value:T,children:!v&&t})},f=(n(19),n(8)),O=function(){var e=Object(r.useContext)(h),t=e.user,n=e.logoutUser;return Object(p.jsxs)("div",{className:"header-container",children:[Object(p.jsx)("span",{className:"logo",children:"ToDO"}),Object(p.jsxs)("div",{children:[Object(p.jsx)(f.b,{className:"mr-4",to:"/",children:"Home"}),t?Object(p.jsxs)(f.b,{to:"/login",onClick:n,children:["Hello, ",t.username," - Logout"]}):Object(p.jsx)(f.b,{to:"/login",children:"Login"})]})]})},x=function(e){var t=e.handleRegisterClick,n=Object(r.useContext)(h).loginUser;return Object(p.jsxs)("div",{className:"todo-container",children:[Object(p.jsx)("h5",{children:"LOG IN"}),Object(p.jsxs)("form",{onSubmit:n,children:[Object(p.jsx)("div",{className:"username",children:Object(p.jsx)("input",{className:"form-control",type:"text",name:"username",placeholder:"Username"})}),Object(p.jsx)("div",{className:"password",children:Object(p.jsx)("input",{className:"form-control",type:"password",name:"password",placeholder:"Password"})}),Object(p.jsx)("div",{className:"login",children:Object(p.jsx)("input",{className:"btn btn-success",type:"submit",value:"Login"})}),Object(p.jsx)("div",{className:"register",children:Object(p.jsx)("button",{className:"btn btn-primary",onClick:t,children:"Register"})})]})]})},v=function(e){var t=e.handleRegisterClick,n=Object(r.useContext)(h).registerUser;return Object(p.jsx)(p.Fragment,{children:Object(p.jsxs)("div",{className:"todo-container",children:[Object(p.jsx)("h5",{children:"REGISTER"}),Object(p.jsxs)("form",{onSubmit:n,children:[Object(p.jsx)("div",{className:"username",children:Object(p.jsx)("input",{className:"form-control",type:"text",name:"username",placeholder:"Username"})}),Object(p.jsx)("div",{className:"password",children:Object(p.jsx)("input",{className:"form-control",type:"password",name:"password",placeholder:"Password"})}),Object(p.jsx)("div",{className:"password",children:Object(p.jsx)("input",{className:"form-control",type:"password",name:"confirm",placeholder:"Confirm"})}),Object(p.jsx)("div",{className:"submit",children:Object(p.jsx)("input",{className:"btn btn-primary",type:"submit",value:"Submit"})}),Object(p.jsx)("div",{className:"login",children:Object(p.jsx)("button",{className:"btn btn-danger",onClick:t,children:"Back"})})]})]})})},g=(n(20),function(){var e=Object(r.useState)(!0),t=Object(d.a)(e,2),n=t[0],s=t[1],a=function(e){e.preventDefault(),s(!n)};return Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)(O,{}),n&&Object(p.jsx)(x,{handleRegisterClick:a}),!n&&Object(p.jsx)(v,{handleRegisterClick:a})]})}),k=function(){var e=Object(r.useContext)(h),t=e.user,n=e.tokens,s=Object(r.useState)({todoList:[],activeItem:{user:t.pk,id:null,title:"",completed:!1},editing:!1}),a=Object(d.a)(s,2),c=a[0],i=a[1];function j(){return b.apply(this,arguments)}function b(){return(b=Object(u.a)(l.a.mark((function e(){var r,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("http://127.0.0.1:8000/api/task-list/",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n.access)}});case 2:return r=e.sent,e.next=5,r.json();case 5:s=e.sent,200===r.status&&i({todoList:s,activeItem:{user:t.pk,id:null,title:"",completed:!1},editing:!1});case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(r.useEffect)((function(){!1===c.editing&&j()}),[c.editing]),Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)(O,{}),Object(p.jsx)("div",{className:"container",children:Object(p.jsx)("div",{className:"task-container",children:Object(p.jsxs)("div",{id:"form-wrapper",children:[Object(p.jsx)("form",{id:"form",onSubmit:function(e){e.preventDefault();var t="http://127.0.0.1:8000/api/task-create/";!0===c.editing&&(t="http://127.0.0.1:8000/api/task-update/".concat(c.activeItem.id,"/"));var r=function(e){var t=null;if(document.cookie&&""!==document.cookie)for(var n=document.cookie.split(";"),r=0;r<n.length;r++){var s=n[r].trim();if(s.substring(0,e.length+1)===e+"="){t=decodeURIComponent(s.substring(e.length+1));break}}return t}("csrftoken");function s(){return(s=Object(u.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(t,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n.access),"X-CSRFToken":r},body:JSON.stringify(c.activeItem)});case 3:i(Object(o.a)(Object(o.a)({},c),{},{editing:!1})),j(),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log("ERROR!");case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}!function(){s.apply(this,arguments)}()},children:Object(p.jsxs)("div",{className:"flex-wrapper",children:[Object(p.jsx)("div",{style:{flex:6},children:Object(p.jsx)("input",{className:"form-control",id:"title",name:"title",onChange:function(e){var t=e.target.value;i(Object(o.a)(Object(o.a)({},c),{},{activeItem:Object(o.a)(Object(o.a)({},c.activeItem),{},{title:t})}))},placeholder:"Title",type:"text",value:c.activeItem.title})}),Object(p.jsx)("div",{style:{flex:1},children:Object(p.jsx)("input",{className:"btn btn-warning",id:"submit",name:"Add",type:"submit"})})]})}),Object(p.jsx)("div",{className:"list-wrapper",children:c.todoList.length>0&&c.todoList.map((function(e){return Object(p.jsxs)("div",{className:"task-wrapper",children:[Object(p.jsx)("div",{className:e.completed?"completed":null,style:{flex:7},onClick:function(){return function(e){e.completed=!e.completed;var t=function(){var t=Object(u.a)(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("http://127.0.0.1:8000/api/task-update/".concat(e.id,"/"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n.access)},body:JSON.stringify(e)});case 2:200===t.sent.status?j():console.log("ERROR updating task completion!");case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();t()}(e)},children:e.title}),Object(p.jsx)("div",{style:{flex:1},children:Object(p.jsx)("button",{className:"btn btn-success",onClick:function(){return function(e){i(Object(o.a)(Object(o.a)({},c),{},{activeItem:e,editing:!0}))}(e)},children:"Edit"})}),Object(p.jsx)("div",{style:{flex:1},children:Object(p.jsx)("button",{className:"btn btn-danger",onClick:function(){return function(e){var t=function(){var t=Object(u.a)(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch("http://127.0.0.1:8000/api/task-delete/".concat(e,"/"),{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n.access)}});case 3:j(),t.next=9;break;case 6:t.prev=6,t.t0=t.catch(0),console.log("ERROR!");case 9:case"end":return t.stop()}}),t,null,[[0,6]])})));return function(){return t.apply(this,arguments)}}();t()}(e.id)},children:"Delete"})})]},e.id)}))})]})})})]})},y=function(e){var t=e.children,n=e.redirect;return Object(r.useContext)(h).user?t:Object(p.jsx)(j.a,{to:n})};var N=function(){return Object(p.jsx)(p.Fragment,{children:Object(p.jsx)(f.a,{children:Object(p.jsx)(m,{children:Object(p.jsxs)(j.d,{children:[Object(p.jsx)(j.b,{element:Object(p.jsx)(g,{}),path:"/login"}),Object(p.jsx)(j.b,{element:Object(p.jsx)(y,{redirect:"/login",children:Object(p.jsx)(k,{})}),path:""})]})})})})};c.a.render(Object(p.jsx)(s.a.StrictMode,{children:Object(p.jsx)(N,{})}),document.getElementById("root"))}},[[21,1,2]]]);
//# sourceMappingURL=main.8b7c5352.chunk.js.map